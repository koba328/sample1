  <script>
    const centerLatLng = [34.6937, 135.5023];
    const map = L.map('map').setView(centerLatLng, 11);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const redIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    // åœ°å›³ä¸­å¿ƒã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    L.marker(centerLatLng, { icon: redIcon })
      .addTo(map)
      .bindPopup('å¤§é˜ªå¸‚ä¸­å¿ƒ')
      .openPopup();

    // ğŸ”½ åœ°å›³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    map.on('click', function (e) {
      const { lat, lng } = e.latlng;
      L.marker([lat, lng], { icon: redIcon })
        .addTo(map)
        .bindPopup(`ã‚¯ãƒªãƒƒã‚¯ä½ç½®<br>ç·¯åº¦: ${lat.toFixed(5)}<br>çµŒåº¦: ${lng.toFixed(5)}`)
        .openPopup();
    });

    const markers = {};

    async function fetchPositions() {
      const res = await fetch('data/positions.json');
      const data = await res.json();

      for (const id in data) {
        const { lat, lng } = data[id];
        if (markers[id]) {
          markers[id].setLatLng([lat, lng]);
        } else {
          markers[id] = L.marker([lat, lng], { icon: redIcon })
                         .addTo(map)
                         .bindTooltip(id, {
                           permanent: true,
                           direction: "top",
                           offset: [0, -40],
                           className: "label-tooltip"
                         });
        }
      }
    }

    fetchPositions();
    setInterval(fetchPositions, 3000);
  </script>
